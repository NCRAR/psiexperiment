from enaml.widgets.api import Window

from psiaudio.util import octave_space
from psi.context.api import FriendlyCartesianProduct, FriendlyCartesianProductContainer
from psi.context.api import Parameter


CONTEXT_ITEM_DETAIL = {
    # ABR and SAM/RAM EFR
    'freq': {
        'user_friendly_name': 'frequencies',
        'step_unit': 'octave',
        'unit': 'kHz',
        'order_user_managed': False,
        'transform_fn': lambda x: (x * 1e3).round(0),
        'inverse_transform_fn': lambda x: x * 1e-3,
        'round_values': True,
        'range_fn': octave_space,
    },
    'level': {
        'user_friendly_name': 'levels',
        'step_unit': 'dB',
        'unit': 'dB SPL',
        'order_user_managed': True,
    },
}


def create_selector():
    level_param = Parameter(name='level', default=80)
    freq_param = Parameter(name='freq', default=8e3)
    selector = FriendlyCartesianProduct(context_detail=CONTEXT_ITEM_DETAIL)
    selector.append_item(level_param)
    selector.append_item(freq_param)
    return selector


enamldef Main(Window): main:

    FriendlyCartesianProductContainer:
        selector = create_selector()
